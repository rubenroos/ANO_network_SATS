<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ANO habitat-species networks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="ANO networks_files/libs/clipboard/clipboard.min.js"></script>
<script src="ANO networks_files/libs/quarto-html/quarto.js"></script>
<script src="ANO networks_files/libs/quarto-html/popper.min.js"></script>
<script src="ANO networks_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ANO networks_files/libs/quarto-html/anchor.min.js"></script>
<link href="ANO networks_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ANO networks_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ANO networks_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ANO networks_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ANO networks_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ANO habitat-species networks</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="building-habitat-species-networks-using-ano-data" class="level2">
<h2 class="anchored" data-anchor-id="building-habitat-species-networks-using-ano-data">Building habitat-species networks using ANO data</h2>
<p>Ruben E. Roos, Joachim Töpper</p>
<p>— Summary coming —</p>
</section>
<section id="running-code" class="level2">
<h2 class="anchored" data-anchor-id="running-code">Running Code</h2>
<section id="interesting-reading-material" class="level3">
<h3 class="anchored" data-anchor-id="interesting-reading-material">Interesting reading material</h3>
<p>https://cran.r-project.org/web/packages/bipartite/vignettes/Intro2bipartite.pdf</p>
</section>
<section id="for-fixing-errors-when-reading-scandinavian-letters" class="level3">
<h3 class="anchored" data-anchor-id="for-fixing-errors-when-reading-scandinavian-letters">For fixing errors when reading Scandinavian letters</h3>
<p>https://www.r-bloggers.com/2013/01/r-and-foreign-characters</p>
<p>https://community.rstudio.com/t/possible-bug-non-ascii-characters-not-displayed-properly-in-the-rstudio-release-2021-09-02/126312/2</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#|output: false</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#|message: false</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#|results: hide</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Sys.setlocale</span>(<span class="at">locale=</span><span class="st">'no_NB.utf8'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "LC_COLLATE=no_NB.utf8;LC_CTYPE=no_NB.utf8;LC_MONETARY=no_NB.utf8;LC_NUMERIC=C;LC_TIME=no_NB.utf8"</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#knitr::opts_chunk$set()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-required-packages" class="level3">
<h3 class="anchored" data-anchor-id="load-required-packages">Load required packages</h3>
<div class="cell">

</div>
</section>
<section id="data-import" class="level3">
<h3 class="anchored" data-anchor-id="data-import">Data import</h3>
<div class="cell">

</div>
</section>
<section id="some-initial-data-exploration" class="level3">
<h3 class="anchored" data-anchor-id="some-initial-data-exploration">Some initial data exploration</h3>
<p>Before we start our analyses, we can explore the data a bit. In addition, we can calculate some basic metrics and have a look at red-listed species.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(ANO.fjell<span class="sc">$</span>Species) </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(Species) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Species)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ANO.fjell)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(ANO.fjell<span class="sc">$</span>ano_flate_id)<span class="co">#list the unique flate IDs</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We can calculate some general metrics e.g., the average number of species per ANO-punkt, per NiN-type, etc.</p>
<p>NB: there are duplicates in the data set (duplicated species registrations within the same site and entire duplicated sites). For now the duplicated sites are removed entirely, but this is not a durable solution.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate and add relative cover per species per ANO plot to the data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>(art_dekning <span class="sc">==</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span> <span class="co">#We should remove the plots where only one species without cover was registered (this is obligatory in the data sampling protocol when no species are present)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dekning_sum =</span> <span class="fu">sum</span>(art_dekning, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rel_dekning =</span> (art_dekning<span class="sc">/</span>dekning_sum))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#We also have one registration of C. bigelowii without any cover, which should be removed</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(art_dekning))</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Check if there are any duplicates in the data (i.e. same species registered twice per plot)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="sc">%&gt;%</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id, Species) <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="co">#Duplicates found!! both duplicated species registration within the same ano_punkt, and duplicated flate_id</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20,064 × 3
# Groups:   ano_punkt_id, Species [20,064]
   ano_punkt_id Species                         n
   &lt;chr&gt;        &lt;chr&gt;                       &lt;int&gt;
 1 ANO0055_53   Juncus trifidus                 2
 2 ANO0064_22   Carex bigelowii                 2
 3 ANO0064_22   Luzula arcuata                  2
 4 ANO0064_33   Carex lachenalii                2
 5 ANO0064_33   Carex rariflora                 2
 6 ANO0076_11   Avenella flexuosa               2
 7 ANO0076_11   Betula nana                     2
 8 ANO0076_11   Calamagrostis phragmitoides     2
 9 ANO0076_11   Chamaepericlymenum suecicum     2
10 ANO0076_11   Empetrum nigrum                 2
# ℹ 20,054 more rows</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove the plots (punkt_id) with duplicated data entirely. To do this, we first make a list, and then filter the data on that list. </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>duplicate_list <span class="ot">&lt;-</span> <span class="fu">as.list</span>(ANO.fjell <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id, Species) <span class="sc">%&gt;%</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;</span><span class="dv">1</span>))</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Filter the data by the list</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>ano_punkt_id <span class="sc">%in%</span> duplicate_list[[<span class="st">"ano_punkt_id"</span>]])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates the most frequently recorded nature type</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n))<span class="co">#T3-C-2 (kalkfattig fjell-lynghei) is by far the most common nature type recorded</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,315 × 3
# Groups:   ano_punkt_id [2,315]
   ano_punkt_id kartleggingsenhet_1m2     n
   &lt;chr&gt;        &lt;chr&gt;                 &lt;int&gt;
 1 ANO1210_15   T7-C-3                   36
 2 ANO0654_66   T7-C-6                   33
 3 ANO0225_64   T3-C-7                   32
 4 ANO1503_66   V1-C-7                   32
 5 ANO0995_44   T3-C-14                  31
 6 ANO0081_31   T3-C-8                   30
 7 ANO0414_55   V1-C-4                   30
 8 ANO0416_33   T7-C-6                   29
 9 ANO0416_42   T7-C-6                   29
10 ANO1503_51   T32-C-5                  29
# ℹ 2,305 more rows</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculates number of species per ANO point</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>sr <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">species_richness =</span> <span class="fu">n</span>(), <span class="at">nature_type =</span> <span class="fu">first</span>(kartleggingsenhet_1m2))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>sr <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  ano_punkt_id species_richness nature_type
  &lt;chr&gt;                   &lt;int&gt; &lt;chr&gt;      
1 ANO0010_13                 12 T3-C-5     
2 ANO0010_15                  8 T14-C-1    
3 ANO0010_26                  9 T14-C-1    
4 ANO0010_33                 11 T4-C-2     
5 ANO0010_35                 10 T14-C-1    
6 ANO0010_44                 17 T3-C-4     </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate average number of species per NiN nature type</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>sr <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(nature_type) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_sr =</span> <span class="fu">mean</span>(species_richness, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_sr))<span class="co">#orders to view the most species rich nature type first</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 × 2
   nature_type mean_sr
   &lt;chr&gt;         &lt;dbl&gt;
 1 T18            27  
 2 T32-C-5        27  
 3 T16-C-3        21  
 4 V6-C-2         21  
 5 T7-C-6         20.7
 6 T20-C-2        20  
 7 T22-C-3        19.6
 8 T18-C-1        19  
 9 T3-C-11        19  
10 T3-C-14        19  
# ℹ 97 more rows</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate how frequently the redlist categories occur per nature type</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>habitat.RL <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(kartleggingsenhet_1m2, Species, Kategori<span class="fl">.2021</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Kategori.2021 =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Kategori<span class="fl">.2021</span>), <span class="st">"IE"</span>, Kategori<span class="fl">.2021</span>)) <span class="sc">%&gt;%</span>   <span class="co">#"NA" is an unfortunately classification to use here, change them to "ikke egnet": "IE"</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co">#creates a species list per NiN nature type and their redlist status</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">"Number of species"</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(Kategori<span class="fl">.2021</span>, <span class="fu">list</span>(<span class="at">IE =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"IE"</span>),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                                <span class="at">LC =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"LC"</span>),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">DD =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"DD"</span>),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">NT =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"NT"</span>), </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>                                <span class="at">VU =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"VU"</span>),</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">EN =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"EN"</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">CR =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"CR"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">RE =</span> <span class="sc">~</span> <span class="fu">sum</span>(. <span class="sc">==</span> <span class="st">"RE"</span>)))) <span class="sc">%&gt;%</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">RL =</span> <span class="fu">sum</span>(Kategori<span class="fl">.2021</span>_DD, Kategori<span class="fl">.2021</span>_NT, Kategori<span class="fl">.2021</span>_VU, </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                    Kategori<span class="fl">.2021</span>_EN, Kategori<span class="fl">.2021</span>_CR, Kategori<span class="fl">.2021</span>_RE), </span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">TS =</span> <span class="fu">sum</span>(Kategori<span class="fl">.2021</span>_VU, Kategori<span class="fl">.2021</span>_EN, Kategori<span class="fl">.2021</span>_CR)) <span class="sc">%&gt;%</span> <span class="co">#add number of readlisted species (DD-RE), and threatened species (VU, EN, CR)</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(RL))<span class="co">#order nature types by most redlisted species: T27-C-6 (kalkfattig og intermediaer rabbepreget blokkmark) has most RL species</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `ano_punkt_id`</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate community weighted value for cold requirement per ANOplot</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id) <span class="sc">%&gt;%</span> </span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cwm_cold_requirement =</span> <span class="fu">weighted.mean</span>(Cold_requirement, rel_dekning, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,315 × 2
   ano_punkt_id cwm_cold_requirement
   &lt;chr&gt;                       &lt;dbl&gt;
 1 ANO0010_13                   8.48
 2 ANO0010_15                  12.2 
 3 ANO0010_26                   7.52
 4 ANO0010_33                   4.59
 5 ANO0010_35                  11.2 
 6 ANO0010_44                   7.29
 7 ANO0010_46                   4.69
 8 ANO0010_53                   3.92
 9 ANO0010_62                   3.74
10 ANO0010_64                   4.68
# ℹ 2,305 more rows</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate community weighted value or cold requirement per NiN nature type</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Ruben: not sure if this is the best way to do it?</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>habitat.cwm.cold<span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cwm_cold_requirement =</span> <span class="fu">weighted.mean</span>(Cold_requirement, rel_dekning, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(cwm_cold_requirement))</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#This gives the exact same result:</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id, kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">cwm_cold_requirement =</span> <span class="fu">weighted.mean</span>(Cold_requirement, rel_dekning, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_cwm_cold_requirement =</span> <span class="fu">mean</span>(cwm_cold_requirement, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_cwm_cold_requirement))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ano_punkt_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 107 × 2
   kartleggingsenhet_1m2 mean_cwm_cold_requirement
   &lt;chr&gt;                                     &lt;dbl&gt;
 1 T27-C-7                                    16.1
 2 T13-C-3                                    16  
 3 T26-C-2                                    15.3
 4 T7-C-13                                    15.2
 5 V6-C-2                                     15.0
 6 V4-C-4                                     14.9
 7 T26-C-1                                    14.8
 8 T7-C-8                                     14.5
 9 T7-C-4                                     14.5
10 V6-C-4                                     14.4
# ℹ 97 more rows</code></pre>
</div>
</div>
<p>We can expect a correlation between the number of redlisted species and the cold requirements, because many mountain species are redlisted due to climate change.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#combine data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>RL.cold <span class="ot">&lt;-</span> habitat.RL <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(habitat.cwm.cold, <span class="at">by =</span> <span class="st">"kartleggingsenhet_1m2"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>RL.cold <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cwm_cold_requirement, <span class="at">y =</span> RL)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Redlist%20vs%20cold%20requirements-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="building-network-models" class="level3">
<h3 class="anchored" data-anchor-id="building-network-models">Building network models</h3>
<section id="preparing-data-for-analyses" class="level4">
<h4 class="anchored" data-anchor-id="preparing-data-for-analyses">Preparing data for analyses</h4>
<p>For building network models, we want a data file that contains all the “kartleggingsenheter” across the data set, their species, and the cumulative abundance of all individual species. This is also a nice opportunity to rename the ANO-specific terms into terms that are more understandable to the average reader. We will refer to “Flate” as Site, “Punkt” as Plot, “Kartleggingsenhet_1m2” will be refered to as Nature type, registered at each Plot. At each Plot, all plant species and their cover are recorded.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Update the column names, this code will keep all the individual plots and their recorded nature types and species. The code below will summarize per Site. </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>ANO.cover <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ano_flate_id, ano_punkt_id, kartleggingsenhet_1m2, Species, art_dekning) <span class="sc">%&gt;%</span>  </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Habitat_type =</span> kartleggingsenhet_1m2, </span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">Species_cover =</span> art_dekning, </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> ano_flate_id, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">Plot =</span> ano_punkt_id)<span class="co">#more user-friendly colnames</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate species cover per naturype per Site (using sum)</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ANO.cover.sum <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(ano_flate_id, ano_punkt_id, kartleggingsenhet_1m2, Species, art_dekning) <span class="sc">%&gt;%</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_flate_id, kartleggingsenhet_1m2, Species) <span class="sc">%&gt;%</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">cover_sum =</span> <span class="fu">sum</span>(art_dekning)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Habitat_type =</span> kartleggingsenhet_1m2, </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">Species_cover_summed =</span> cover_sum, </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">Site =</span> ano_flate_id)<span class="co">#more user-friendly colnames</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ano_flate_id', 'kartleggingsenhet_1m2'.
You can override using the `.groups` argument.</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to wide format</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ANO.cover <span class="ot">&lt;-</span> ANO.cover <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Species, <span class="at">values_from =</span> Species_cover, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Nature_type =</span> Habitat_type)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>ANO.cover.sum <span class="ot">&lt;-</span> ANO.cover.sum <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Species, <span class="at">values_from =</span> Species_cover_summed, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">Nature_type =</span> Habitat_type)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset that calculates the most frequent nin type per Flate</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>ANO.type <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(ano_flate_id, ano_punkt_id, kartleggingsenhet_1m2) <span class="sc">%&gt;%</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_punkt_id, ano_flate_id) <span class="sc">%&gt;%</span> </span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">kartleggingsenhet_1m2 =</span> <span class="fu">first</span>(kartleggingsenhet_1m2)) <span class="sc">%&gt;%</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ano_flate_id) <span class="sc">%&gt;%</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Common_nature_type =</span> <span class="fu">names</span>(<span class="fu">which.max</span>(<span class="fu">table</span>(kartleggingsenhet_1m2)))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Site=</span> ano_flate_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'ano_punkt_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Join these two data frames</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ANO.cover <span class="ot">&lt;-</span> ANO.cover <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(ANO.type, <span class="at">by =</span> <span class="st">"Site"</span>) </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Creates a patch dataframe to store its properties. Assigns a unique color to each nature type in the dataset. </span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>Nature.types <span class="ot">&lt;-</span> <span class="fu">unique</span>(ANO.cover[, <span class="fu">c</span>(<span class="st">"Plot"</span>, <span class="st">"Nature_type"</span>)])</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>Nature.types <span class="ot">&lt;-</span> Nature.types <span class="sc">%&gt;%</span> </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(Nature_type) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">Color =</span> randomcoloR<span class="sc">::</span><span class="fu">randomColor</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="worked-example-for-one-site" class="level4">
<h4 class="anchored" data-anchor-id="worked-example-for-one-site">Worked example for one site</h4>
<p>First, let’s visualize the network</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#For a proof of concept, let's select one random Site and create a network for it. </span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> ANO.cover <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Site <span class="sc">==</span> <span class="st">"ANO1517"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Remove all columns (species) that sum to zero and are not recorded at the site</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">select</span>(<span class="fu">where</span>(<span class="sc">~</span> <span class="fu">is.numeric</span>(.) <span class="sc">&amp;&amp;</span> <span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">&gt;</span> <span class="dv">0</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Adding missing grouping variables: `Plot`</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a matrix</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>ntw.ANO <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(df[<span class="dv">2</span><span class="sc">:</span><span class="dv">28</span>]) <span class="co">#assign columns included manually</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ntw.ANO)<span class="ot">&lt;-</span> df<span class="sc">$</span>Plot</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#We can use package _bipartite_ to plot the network:</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>legend <span class="ot">&lt;-</span> <span class="fu">unique</span>(Nature.types[,<span class="fu">c</span>(<span class="st">"Nature_type"</span>, <span class="st">"Color"</span>)])<span class="co">#prepare legend</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> T) <span class="co">#allow plotting outside the plot</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plotweb</span>(ntw.ANO, <span class="at">col.low =</span> <span class="fu">as.character</span>(Nature.types<span class="sc">$</span>Color))</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="fl">0.25</span>, <span class="fu">as.character</span>(legend<span class="sc">$</span>Nature_type), <span class="at">pch=</span><span class="dv">21</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"#777777"</span>, <span class="at">pt.bg=</span><span class="fu">as.character</span>(legend<span class="sc">$</span>Color), </span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">pt.cex=</span><span class="dv">1</span>, <span class="at">cex=</span>.<span class="dv">6</span>, <span class="at">bty=</span><span class="st">"n"</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Worked%20example%20for%20one%20site-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">visweb</span>(ntw.ANO, <span class="at">prednames =</span> T, <span class="at">preynames =</span> T, <span class="at">labsize =</span> <span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Worked%20example%20for%20one%20site-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#See also: https://briatte.github.io/ggnet/</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can examine how the network is structured, for example by calculating nestedness. Here, we use weighted NODF, one of the more popular and robust nestedness metrics (Almeida-Neto et al.&nbsp;2008, Almeida-Neto et al.&nbsp;2010), but other options are also available.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>(obs <span class="ot">&lt;-</span> <span class="fu">networklevel</span>(<span class="at">web =</span> ntw.ANO, <span class="at">index =</span> <span class="st">"weighted NODF"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>weighted NODF 
     21.91355 </code></pre>
</div>
</div>
<p>To know if 21.9135478 is more nested than expected by chance for this network, we need to compare it with a null model:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>nm <span class="ot">&lt;-</span> <span class="fu">nullmodel</span>(<span class="at">web =</span> ntw.ANO, <span class="at">N=</span><span class="dv">100</span>, <span class="at">method=</span><span class="st">"vaznull"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>null <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">sapply</span>(nm, networklevel, <span class="at">index=</span><span class="st">"weighted NODF"</span>)) </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(null), <span class="at">xlim=</span><span class="fu">c</span>(<span class="fu">min</span>(obs, <span class="fu">min</span>(null)), <span class="fu">max</span>(obs, <span class="fu">max</span>(null))), </span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">main=</span><span class="st">"comparison of observed with null model Patefield"</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span>obs, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)    </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Nestedness%20vs%20null-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>praw <span class="ot">&lt;-</span> <span class="fu">sum</span>(null<span class="sc">&gt;</span>obs) <span class="sc">/</span> <span class="fu">length</span>(null)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here, we can see that this network is less nested than expected by chance (p value 0)). This suggests that these species do not use habitats in a nested way (i.e.&nbsp;species-rich habitats do not host species found in species poor habitats) and we should check for other network structural features.</p>
<p>To gain further insights on the structure of species habitats networks, we can use another important structural metric: modularity. In this example, we will calculate a quantitative version of the metric (Dormann et al., 2014).</p>
<p>For info on this: Detecting modules in quantitative bipartite networks: the QuaBiMo algorithm –&nbsp;arXiv Vanity (arxiv-vanity.com)</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">metaComputeModules</span>(ntw.ANO, <span class="at">N =</span> <span class="dv">5</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotModuleWeb</span>(res, <span class="at">displayAlabels =</span> <span class="cn">TRUE</span>, <span class="at">displayBlabels =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'

Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Module%20figure-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co">#listModuleInformation(res)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#printoutModuleInformation(res)</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>modules.nulls <span class="ot">&lt;-</span> <span class="fu">sapply</span>(nm, computeModules)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>like.nulls <span class="ot">&lt;-</span> <span class="fu">sapply</span>(modules.nulls, <span class="cf">function</span>(x) x<span class="sc">@</span>likelihood)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>praw <span class="ot">&lt;-</span> <span class="fu">sum</span>(like.nulls <span class="sc">&gt;</span> res<span class="sc">@</span>likelihood) <span class="sc">/</span> <span class="fu">length</span>(like.nulls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The network is more modular than expected by chance (p-value &lt; 0). This confirms that each habitat tends to harbour a quite unique assemblage of species, with limited exchange between habitat patches. The modules identified here do not immediately cluster true to the nature type they were assigned.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we can calculate 2 values for each node</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cz <span class="ot">&lt;-</span> <span class="fu">czvalues</span>(res, <span class="at">weighted =</span> <span class="cn">TRUE</span>, <span class="at">level =</span> <span class="st">"lower"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'

Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'

Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in dim(slot(moduleWebObject, "originalWeb")) == 0 ||
dim(slot(moduleWebObject, : 'length(x) = 2 &gt; 1' in coercion to 'logical(1)'</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#c : among-module connectivity</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co">#z : within-module connectivity</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Olesen et al. (2006) give critical c and z values of 0.62 and 2.6, respectively. Species exceeding these values are deemed connectors or hubs of a network. The justification of these thresholds remains unclear to me. They may also not apply for the quantitative version.</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cz[[<span class="dv">1</span>]], cz[[<span class="dv">2</span>]], <span class="at">pch=</span><span class="dv">16</span>, <span class="at">xlab=</span><span class="st">"c"</span>, <span class="at">ylab=</span><span class="st">"z"</span>, </span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex=</span><span class="fl">0.8</span>, <span class="at">las=</span><span class="dv">1</span>, <span class="at">col =</span> Nature.types<span class="sc">$</span>Color)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(cz[[<span class="dv">1</span>]], cz[[<span class="dv">2</span>]], <span class="fu">names</span>(cz[[<span class="dv">1</span>]]), <span class="at">pos=</span><span class="dv">4</span>, <span class="at">cex=</span><span class="fl">0.7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/cz%20values-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#What does this mean?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we can ask which habitat patches (nature types would we prioritize for its conservation value. For this we can calculate its strength (Bascopmte et al 2006). We can use the “specieslevel” function to calculate a lot of other parameters for each species and nature type. Use “networklevel” to calculate parameters for the whole network</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#we transpose the matrix to calculate it for the lower level.</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Cons.val$strength &lt;- bipartite::strength(ntw.ANO, type="Bascompte")#doesn't work because not all nature types are included</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Cons.val</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>bipartite<span class="sc">::</span><span class="fu">strength</span>(<span class="fu">t</span>(ntw.ANO))<span class="co">#produces NaN for strength??</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ANO1517_24 ANO1517_55 ANO1517_42 ANO1517_46 ANO1517_66 ANO1517_35 ANO1517_13 
 6.3738858  1.5050080  1.0988418  3.4833585  1.0517341  0.6501543  1.1910833 
ANO1517_15 ANO1517_64 ANO1517_51 ANO1517_11 ANO1517_44 ANO1517_22 ANO1517_62 
 0.7494878  0.7644143  2.8204363  0.7965628  1.2824859  0.9316931  0.7199012 
ANO1517_33 ANO1517_31 ANO1517_53 ANO1517_26 
 0.1977401  1.1328712  1.6926633  0.5576782 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>bipartite<span class="sc">::</span><span class="fu">strength</span>(ntw.ANO, <span class="at">type=</span><span class="st">"Bascompte"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>        Vaccinium myrtillus           Avenella flexuosa 
                1.771598745                 0.169297751 
            Carex bigelowii             Empetrum nigrum 
                0.149537561                 1.292029305 
                Betula nana        Vaccinium uliginosum 
                2.930072046                 0.650572527 
       Eriophorum vaginatum         Andromeda polifolia 
                1.985130347                 0.203890055 
          Rubus chamaemorus       Vaccinium vitis-idaea 
                2.457810384                 0.338506473 
           Calluna vulgaris     Trichophorum cespitosum 
                2.151433857                 0.041666667 
               Salix glauca            Comarum palustre 
                0.113043478                 0.269565217 
             Carex rostrata             Carex canescens 
                2.674642749                 0.026086957 
              Rumex acetosa                Carex limosa 
                0.008695652                 0.119927536 
          Juncus filiformis Calamagrostis phragmitoides 
                0.073244147                 0.017391304 
   Eriophorum angustifolium              Nardus stricta 
                0.090909091                 0.215465593 
                Picea abies         Oxycoccus palustris 
                0.035481963                 0.114544453 
        Melampyrum pratense              Arctous alpina 
                0.048345030                 0.027777778 
           Carex pauciflora 
                0.023333333 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">#check many more parameters by species/Nature type</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">specieslevel</span>(ntw.ANO, <span class="at">level =</span> <span class="st">"lower"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           degree normalised.degree species.strength interaction.push.pull
ANO1517_24      9        0.33333333        6.3738858           0.597098425
ANO1517_55      7        0.25925926        1.5050080           0.072143996
ANO1517_42      8        0.29629630        1.0988418           0.012355219
ANO1517_46      9        0.33333333        3.4833585           0.275928718
ANO1517_66     12        0.44444444        1.0517341           0.004311174
ANO1517_35      5        0.18518519        0.6501543          -0.069969147
ANO1517_13      7        0.25925926        1.1910833           0.027297611
ANO1517_15      7        0.25925926        0.7494878          -0.035787452
ANO1517_64      8        0.29629630        0.7644143          -0.029448207
ANO1517_51      7        0.25925926        2.8204363           0.260062334
ANO1517_11      7        0.25925926        0.7965628          -0.029062462
ANO1517_44      2        0.07407407        1.2824859           0.141242938
ANO1517_22     10        0.37037037        0.9316931          -0.006830686
ANO1517_62      6        0.22222222        0.7199012          -0.046683131
ANO1517_33      1        0.03703704        0.1977401          -0.802259887
ANO1517_31     11        0.40740741        1.1328712           0.012079204
ANO1517_53      9        0.33333333        1.6926633           0.076962590
ANO1517_26      8        0.29629630        0.5576782          -0.055290228
           nestedrank       PDI species.specificity.index resource.range
ANO1517_24 0.29411765 0.9500000                 0.5055746      0.6923077
ANO1517_55 0.58823529 0.9368389                 0.5224483      0.7692308
ANO1517_42 0.47058824 0.9386447                 0.4738574      0.7307692
ANO1517_46 0.23529412 0.9479638                 0.4516529      0.6923077
ANO1517_66 0.00000000 0.9560440                 0.5146470      0.5769231
ANO1517_35 0.88235294 0.9469496                 0.5636717      0.8461538
ANO1517_13 0.70588235 0.9273504                 0.4432984      0.7692308
ANO1517_15 0.52941176 0.9021978                 0.4475695      0.7692308
ANO1517_64 0.41176471 0.9142857                 0.4313719      0.7307692
ANO1517_51 0.76470588 0.9261954                 0.4330127      0.7692308
ANO1517_11 0.64705882 0.9403205                 0.5072141      0.7692308
ANO1517_44 0.94117647 0.9961538                 0.9101393      0.9615385
ANO1517_22 0.11764706 0.9069872                 0.4154316      0.6538462
ANO1517_62 0.82352941 0.9415385                 0.5053352      0.8076923
ANO1517_33 1.00000000 1.0000000                 1.0000000      1.0000000
ANO1517_31 0.05882353 0.9152308                 0.4163246      0.6153846
ANO1517_53 0.17647059 0.9154533                 0.4072499      0.6923077
ANO1517_26 0.35294118 0.9094812                 0.4797122      0.7307692
                 PSI node.specialisation.index.NSI betweenness
ANO1517_24 6.3738858                      1.058824 0.296296296
ANO1517_55 1.5050080                      1.117647 0.002645503
ANO1517_42 1.0988418                      1.117647 0.002645503
ANO1517_46 3.4833585                      1.000000 0.335978836
ANO1517_66 1.0517341                      1.117647 0.002645503
ANO1517_35 0.6501543                      1.117647 0.002645503
ANO1517_13 1.1910833                      1.000000 0.335978836
ANO1517_15 0.7494878                      1.117647 0.002645503
ANO1517_64 0.7644143                      1.117647 0.002645503
ANO1517_51 2.8204363                      1.176471 0.000000000
ANO1517_11 0.7965628                      1.117647 0.002645503
ANO1517_44 1.2824859                      1.764706 0.000000000
ANO1517_22 0.9316931                      1.117647 0.002645503
ANO1517_62 0.7199012                      1.117647 0.002645503
ANO1517_33 0.1977401                      1.764706 0.000000000
ANO1517_31 1.1328712                      1.117647 0.002645503
ANO1517_53 1.6926633                      1.117647 0.002645503
ANO1517_26 0.5576782                      1.117647 0.002645503
           weighted.betweenness  closeness weighted.closeness Fisher.alpha
ANO1517_24           0.19230769 0.05913978         0.02243675           NA
ANO1517_55           0.00000000 0.05734767         0.04968889           NA
ANO1517_42           0.00000000 0.05734767         0.03457742           NA
ANO1517_46           0.12179487 0.06093190         0.03357651           NA
ANO1517_66           0.00000000 0.05734767         0.04352792           NA
ANO1517_35           0.03846154 0.05734767         0.06172877           NA
ANO1517_13           0.16666667 0.06093190         0.03930841           NA
ANO1517_15           0.31410256 0.05734767         0.06528072           NA
ANO1517_64           0.00000000 0.05734767         0.03725839           NA
ANO1517_51           0.00000000 0.05555556         0.03358832           NA
ANO1517_11           0.00000000 0.05734767         0.04501073           NA
ANO1517_44           0.00000000 0.03763441         0.02076029           NA
ANO1517_22           0.16666667 0.05734767         0.05252410           NA
ANO1517_62           0.00000000 0.05734767         0.04150320           NA
ANO1517_33           0.00000000 0.03763441         0.01616426           NA
ANO1517_31           0.00000000 0.05734767         0.04603710           NA
ANO1517_53           0.00000000 0.05734767         0.04618803           NA
ANO1517_26           0.00000000 0.05734767         0.04631703           NA
           partner.diversity effective.partners proportional.similarity
ANO1517_24         1.5554737           4.737330              0.11633067
ANO1517_55         1.3207150           3.746099              0.49283974
ANO1517_42         1.6067616           4.986636              0.41536853
ANO1517_46         1.7931495           6.008346              0.36583821
ANO1517_66         1.6324819           5.116558              0.56653950
ANO1517_35         1.2147296           3.369383              0.53979619
ANO1517_13         1.6569201           5.243137              0.49355829
ANO1517_15         1.5863584           4.885924              0.65292580
ANO1517_64         1.6703427           5.313989              0.60619014
ANO1517_51         1.6859304           5.397470              0.35990185
ANO1517_11         1.4046668           4.074169              0.49080385
ANO1517_44         0.3046361           1.356131              0.07202786
ANO1517_22         1.7666337           5.851123              0.63452754
ANO1517_62         1.3862491           3.999819              0.46264426
ANO1517_33         0.0000000           1.000000              0.07004907
ANO1517_31         1.7897186           5.987768              0.59848254
ANO1517_53         1.7726216           5.886264              0.56017911
ANO1517_26         1.4658630           4.331279              0.51662599
           proportional.generality         d
ANO1517_24              0.43796070 0.7694082
ANO1517_55              0.34632252 0.2702243
ANO1517_42              0.46100876 0.2972016
ANO1517_46              0.55546466 0.4145051
ANO1517_66              0.47301984 0.1843744
ANO1517_35              0.31149555 0.2562209
ANO1517_13              0.48472201 0.2649272
ANO1517_15              0.45169803 0.1604533
ANO1517_64              0.49127213 0.1624240
ANO1517_51              0.49898991 0.3975493
ANO1517_11              0.37665223 0.2613348
ANO1517_44              0.12537279 0.6959143
ANO1517_22              0.54092961 0.1956685
ANO1517_62              0.36977866 0.3259998
ANO1517_33              0.09244885 0.6142711
ANO1517_31              0.55356221 0.1757412
ANO1517_53              0.54417835 0.2976427
ANO1517_26              0.40042180 0.2280140</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Check many parameters for the whole network</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">networklevel</span>(ntw.ANO)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                      connectance                     web asymmetry 
                     2.736626e-01                      2.000000e-01 
                links per species            number of compartments 
                     2.955556e+00                      1.000000e+00 
            compartment diversity               cluster coefficient 
                               NA                      1.666667e-01 
                     modularity Q                        nestedness 
                     3.494118e-01                      2.487347e+01 
                             NODF               weighted nestedness 
                     3.771622e+01                      2.211934e-01 
                    weighted NODF    interaction strength asymmetry 
                     2.191355e+01                      4.280782e-02 
         specialisation asymmetry                   linkage density 
                     7.398062e-02                      6.264443e+00 
             weighted connectance                      Fisher alpha 
                     1.392098e-01                                NA 
                Shannon diversity              interaction evenness 
                     4.345224e+00                      7.024051e-01 
     Alatalo interaction evenness                                H2 
                     7.964881e-01                      3.986252e-01 
             number.of.species.HL              number.of.species.LL 
                     2.700000e+01                      1.800000e+01 
mean.number.of.shared.partners.HL mean.number.of.shared.partners.LL 
                     1.393162e+00                      3.281046e+00 
           cluster.coefficient.HL            cluster.coefficient.LL 
                     5.763284e-01                      2.911471e-01 
  weighted.cluster.coefficient.HL   weighted.cluster.coefficient.LL 
                     9.504820e-01                      8.616285e-01 
                 niche.overlap.HL                  niche.overlap.LL 
                     1.649416e-01                      3.543390e-01 
                  togetherness.HL                   togetherness.LL 
                     1.075499e-01                      2.817357e-01 
                       C.score.HL                        C.score.LL 
                     5.945009e-01                      3.963243e-01 
                       V.ratio.HL                        V.ratio.LL 
                     5.245968e+00                      1.836913e+00 
                   discrepancy.HL                    discrepancy.LL 
                     4.400000e+01                      5.600000e+01 
              extinction.slope.HL               extinction.slope.LL 
                     7.330043e+00                      3.126073e+00 
                    robustness.HL                     robustness.LL 
                     8.280708e-01                      6.866461e-01 
    functional.complementarity.HL     functional.complementarity.LL 
                     1.139841e+03                      1.084238e+03 
             partner.diversity.HL              partner.diversity.LL 
                     1.964125e+00                      1.524804e+00 
                    generality.HL                  vulnerability.LL 
                     7.756091e+00                      4.772795e+00 </code></pre>
</div>
</div>
</section>
<section id="removing-species-and-habitats" class="level4">
<h4 class="anchored" data-anchor-id="removing-species-and-habitats">Removing species and habitats</h4>
<p>To test the robustness of the network, we can remove species (or habitats). Robustness is defined as the area beneath the extinction curve. Extinctions can be random, based on abundance or connectedness (method = degree, very extreme case with common, well-connected species going first). A custom list e.g., based on redlist status can also be provided.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>ntw.ext.rand <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"random"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of species</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>ntw.ext.abun <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">50</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"abundance"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#removing the least abundant species first</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>ntw.ext.degr <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">50</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"degree"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#removing the most connected species first</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>ntw.ext.habitat.rand <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"random"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>)<span class="co">#random removal of nature types</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>ntw.ext.habitat.abun <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"abundance"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of nature types based on abundance (least first)</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>ntw.ext.habitat.degr <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"degree"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of nature types based on connections (most first)</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate robustness (surface area underneath the extinction curve)</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="fu">robustness</span>(<span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO, <span class="at">nrep =</span> <span class="dv">50</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"abundance"</span>, <span class="at">details =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5895621</code></pre>
</div>
</div>
<p>Plot the extinction curve</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.rand, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
7.591569 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.abun, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
31.59164 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.degr, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
1.315732 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.habitat.rand, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
2.747049 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.habitat.abun, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
1.703436 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.ext.habitat.degr, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Plotting%20extinction%20curves-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
1.279516 </code></pre>
</div>
</div>
</section>
<section id="one-network-for-the-entire-dataset" class="level4">
<h4 class="anchored" data-anchor-id="one-network-for-the-entire-dataset">One network for the entire dataset</h4>
<p>An alternative approach is to create one network for the entire dataset. In this case, we can calculate and average cover for each species for each nature type, and then create one network.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create dataset with summed cover for each species per nature type</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ANO.cover.total <span class="ot">&lt;-</span> ANO.cover <span class="sc">%&gt;%</span> </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(Site, Plot, Nature_type, Common_nature_type), <span class="at">names_to =</span> <span class="st">"Species"</span>, <span class="at">values_to =</span> <span class="st">"Species_cover"</span>) <span class="sc">%&gt;%</span> <span class="co">#convert to long format</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Nature_type, Species) <span class="sc">%&gt;%</span> </span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Species_cover_sum =</span> <span class="fu">sum</span>(Species_cover)) <span class="sc">%&gt;%</span> </span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Species, <span class="at">values_from =</span> Species_cover_sum, <span class="at">values_fill =</span> <span class="dv">0</span>) <span class="co">#convert back to wide</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Nature_type'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Convert to matrix for network model</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>ntw.ANO.summed <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(ANO.cover.total[<span class="dv">2</span><span class="sc">:</span><span class="dv">362</span>]) <span class="co">#assign columns included manually</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ntw.ANO.summed)<span class="ot">&lt;-</span> ANO.cover.total<span class="sc">$</span>Nature_type</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co">#We can use package _bipartite_ to plot the network:</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>legend <span class="ot">&lt;-</span> <span class="fu">unique</span>(Nature.types[,<span class="fu">c</span>(<span class="st">"Nature_type"</span>, <span class="st">"Color"</span>)])<span class="co">#prepare legend</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">xpd =</span> T) <span class="co">#allow plotting outside the plot</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plotweb</span>(ntw.ANO.summed, <span class="at">col.low =</span> <span class="fu">as.character</span>(Nature.types<span class="sc">$</span>Color))</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="at">x=</span><span class="dv">0</span>, <span class="at">y=</span><span class="fl">0.25</span>, <span class="fu">as.character</span>(legend<span class="sc">$</span>Nature_type), <span class="at">pch=</span><span class="dv">21</span>,</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="st">"#777777"</span>, <span class="at">pt.bg=</span><span class="fu">as.character</span>(legend<span class="sc">$</span>Color), </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">pt.cex=</span><span class="dv">1</span>, <span class="at">cex=</span>.<span class="dv">6</span>, <span class="at">bty=</span><span class="st">"n"</span>, <span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visweb(ntw.ANO.summed, prednames = T, preynames = T, labsize = 0.6)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Make some extinction curves for this network </span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>ntw.rand <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"random"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of species</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>ntw.abun <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">50</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"abundance"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#removing the least abundant species first</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>ntw.degr <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">50</span>, <span class="at">participant =</span> <span class="st">"higher"</span>, <span class="at">method =</span> <span class="st">"degree"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#removing the most connected species first</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot these</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.rand, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
21.33463 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.abun, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
251.3647 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.degr, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
1.759089 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>ntw.habitat.rand <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"random"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>)<span class="co">#random removal of nature types</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>ntw.habitat.abun <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"abundance"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of nature types based on abundance (least first)</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>ntw.habitat.degr <span class="ot">&lt;-</span> <span class="fu">second.extinct</span>(<span class="at">web =</span> ntw.ANO.summed, <span class="at">nrep =</span> <span class="dv">100</span>, <span class="at">participant =</span> <span class="st">"lower"</span>, <span class="at">method =</span> <span class="st">"degree"</span>, <span class="at">details =</span> <span class="cn">FALSE</span>) <span class="co">#random removal of nature types based on connections (most first)</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot these</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.habitat.rand, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
4.320581 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.habitat.abun, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-6.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
10.77111 </code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">slope.bipartite</span>(ntw.habitat.degr, <span class="at">plot.it =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="ANO-networks_files/figure-html/Dataset%20for%20one%20general%20network-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>exponent 
1.077756 </code></pre>
</div>
</div>
</section>
<section id="extinctions-based-on-rl-status" class="level4">
<h4 class="anchored" data-anchor-id="extinctions-based-on-rl-status">Extinctions based on RL status</h4>
<p>Lets try making extinction curves based on RL status.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create dataset with species and their RL status. We also want a measure of how common they are, such as their summed cover across the whole dataset. </span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>RL <span class="ot">&lt;-</span> ANO.fjell <span class="sc">%&gt;%</span> </span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species, Kategori<span class="fl">.2021</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total.cover =</span> <span class="fu">sum</span>(art_dekning)) <span class="sc">%&gt;%</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Species, Kategori<span class="fl">.2021</span>, Total.cover) <span class="sc">%&gt;%</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">match</span>(Kategori<span class="fl">.2021</span>, <span class="fu">c</span>(<span class="st">"CR"</span>, <span class="st">"EN"</span>, <span class="st">"VU"</span>, <span class="st">"NT"</span>, <span class="st">"DD"</span>, <span class="st">"LC"</span>, <span class="st">"NA"</span>)), <span class="fu">desc</span>(Kategori<span class="fl">.2021</span>), <span class="sc">-</span><span class="fu">desc</span>(Total.cover)) <span class="sc">%&gt;%</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Rank =</span> <span class="fu">row_number</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Species'. You can override using the
`.groups` argument.</code></pre>
</div>
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a species vector that second.extinct understands</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="co">#For this we want the rank for each species in the order it occurs in the network matrix</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>Species <span class="ot">&lt;-</span> ANO.cover.total <span class="sc">%&gt;%</span> </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(Nature_type), <span class="at">names_to =</span> <span class="st">"Species"</span>, <span class="at">values_to =</span> <span class="st">"Species_cover"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(Species)</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>RL.species <span class="ot">&lt;-</span> Species <span class="sc">%&gt;%</span> </span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., RL, <span class="at">by =</span> <span class="st">"Species"</span>)</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>RL.vector <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(RL.species, <span class="at">var =</span> Rank)</span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Now let's do the exctintion curves (using the network for the whole dataset)</span></span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a><span class="co">#ntw.rand &lt;- second.extinct(web = ntw.ANO.summed, nrep = 100, participant = "higher", method = "random", details = FALSE) #random removal of species</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a><span class="co">#ntw.RL &lt;- second.extinct(web = ntw.ANO.summed, nrep = 50, participant = "higher", method = "external", ext.row = RL.vector, details = FALSE) #removing the least abundant species first</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>